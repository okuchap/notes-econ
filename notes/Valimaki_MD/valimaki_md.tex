\documentclass[11pt,a4paper,dvipdfmx]{article}
%\documentclass[autodetect-engine,dvipdfmx-if-dvi,ja=standard]{bxjsarticle}

\usepackage[utf8]{inputenc}
\usepackage{lmodern}
\usepackage[T1]{fontenc}
\usepackage[noBBpl]{mathpazo}
%\linespread{1.05}
\usepackage{mathtools, amsmath, amssymb, amsthm}
\usepackage{amsfonts}
\usepackage{braket}
%\usepackage{amssymb}
\usepackage{url}
\usepackage{cases}
\usepackage{bbm}

%% citation
\usepackage[longnamesfirst]{natbib}

%
\theoremstyle{plain}
\newtheorem{thm}{Thm.}[section]
\newtheorem{lem}{Lem.}[section]
\newtheorem{cor}{Cor.}[section]
\newtheorem{prop}{Prop.}[section]
\newtheorem{df}{Def.}[section]
\newtheorem{eg}{e.g.}[section]
\newtheorem{rem}{Rem.}[section]
\newtheorem{ass}{Ass.}
%

\usepackage{listings}
\lstset{%
language={python},%
basicstyle={\ttfamily\footnotesize},%ソースコードの文字を小さくする
frame={single},
commentstyle={\footnotesize\itshape},%コメントアウトの文字を小さくする
breaklines=true,%行が長くなったときの改行。trueの場合は改行する。
numbers=left,%行番号を左に書く。消す場合はnone。
xrightmargin=3zw,%左の空白の大きさ
xleftmargin=3zw,%右の空白の大きさ
stepnumber=1,%行番号を1から始める場合こうする(たぶん)
numbersep=1zw,%行番号と本文の間隔。
}

%\usepackage[dvipdfmx]{graphicx}
%% color packageとdvipdfmxは相性が悪いらしい
%% https://qiita.com/zr_tex8r/items/442b75b452b11bee8049
\usepackage{graphicx}


\usepackage[left=2cm,right=2cm,top=2cm,bottom=2cm]{geometry} %This changes the margins.
\usepackage{float}
%\author{Kyohei Okumura}
\global\long\def\T#1{#1^{\top}}

\newcommand{\id}{\textnormal{id}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\mF}{\mathcal{F}}
\newcommand{\mG}{\mathcal{G}}
\newcommand{\mA}{\mathcal{A}}
\newcommand{\mB}{\mathcal{B}}
\newcommand{\mC}{\mathcal{C}}
\newcommand{\mD}{\mathcal{D}}
\newcommand{\mE}{\mathcal{E}}
\newcommand{\mL}{\mathcal{L}}
\newcommand{\mN}{\mathcal{N}}
\newcommand{\mM}{\mathcal{M}}
\newcommand{\mO}{\mathcal{O}}
\newcommand{\mP}{\mathcal{P}}
\newcommand{\mS}{\mathcal{S}}
\newcommand{\mT}{\mathcal{T}}
\newcommand{\mV}{\mathcal{V}}
\renewcommand{\Re}{\mathrm{Re}}
\renewcommand{\hat}{\widehat}
\renewcommand{\tilde}{\widetilde}
\renewcommand{\bar}{\overline}
\renewcommand{\epsilon}{\varepsilon}
% \renewcommand{\span}{\mathrm{span}}
\newcommand{\defi}{\stackrel{\Delta}{\Longleftrightarrow}}
\newcommand{\equi}{\Longleftrightarrow}
\newcommand{\s}{\succsim}
\newcommand{\p}{\precsim}
\newcommand{\join}{\vee}
\newcommand{\meet}{\wedge}
\newcommand{\E}{\mathbbm{E}}
\newcommand{\1}{\mathbbm{1}}

\DeclareMathOperator{\Var}{Var}
\DeclareMathOperator{\Cov}{Cov}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\Card}{Card}
\DeclareMathOperator{\supp}{supp}
\DeclareMathOperator{\Log}{Log}
\DeclareMathOperator{\spn}{span}
\DeclareMathOperator*{\argmin}{argmin}
\DeclareMathOperator*{\argmax}{argmax}

\newcommand{\indep}{\mathop{\perp\!\!\!\!\perp}}

\usepackage{color}
\newcommand{\kcomment}[1]{{\textcolor{blue}{#1}}}
\newcommand{\ocomment}[1]{{\textcolor{red}{#1}}}


\begin{document}
\title{Notes on Mechanism Design}
\author{Kyohei OKUMURA
%{\footnote{E-mail: kyohei.okumura@gmail.com}
%\footnote{UTokyo Econ M2}}
}
\date{\today}
\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{itemize}
	\item This study notes are mainly based on the lecture note written by Valimaki in 2018.
\end{itemize}

%%%
\section{Single Agent}
\begin{itemize}
	\item One principal v.s. one agent.
	\item $a \in A$: allocation, $\theta \in \Theta$: agent's private info. $\theta \sim F(\theta)$. $u^P(a, \theta)$, $u^A(a, \theta)$.
	\item We often assume quasi-linear payoff functions:
	\begin{itemize}
	\item $a := (x, t)$, $u^P(a, \theta) := v^P(x, \theta) + t$, $u^A(a, \theta) := v^A(x, \theta) - t$.
	\end{itemize}
	\item A mechanism is a pair $M := (\Sigma, \phi)$, where $\Sigma$ is a message space and $\phi: \Sigma \to \Delta(A)$.
	\item Agent's strategy: $\sigma: \Theta \to \Delta(\Sigma)$. Principal commits to a mechanism $M$.
	\item Consider a social choice function $\psi: \Theta \to A$. We want to know whether $\psi$ is implementable (, i.e., achievable in equilibrium,) or not.
	\item As for implementability, we can discuss it focusing only on direct mechanisms, assuming $\Sigma := \Theta$, w.l.o.g. (Revelation principle)
\end{itemize}


%%%
\subsection{Revenue Equivalence}
\begin{itemize}
	\item In \S1.1 and \S1.2, we assume that the parameter space is a closed interval $\Theta := [\underline{\theta}, \bar{\theta}] \subseteq \R$.
\end{itemize}

\subsubsection{Milgrom and Segal (2002), Envelope Theorem}
\begin{itemize}
	\item $\Theta := [\underline{\theta}, \bar{\theta}]$. $f(\cdot, \theta): X \to \R$. $\{f(\cdot, \theta)\}_{\theta \in \Theta}$.
	\item $V(\theta) := \max_{x \in X} f(x, \theta)$. $X^*(\theta) := \argmax_{x \in X} f(x, \theta)$
\end{itemize}
\begin{df}[Selection]
	A function $x^*: \Theta \to X$ is a selection from $X^*$ if $x^*(\theta) \in X^*(\theta)$ for all $\theta \in \Theta$.
\end{df}
\begin{thm}[Milgrom and Segal (2002)]
	Assume the following:
	\begin{itemize}
		\item For any $x \in X$, $f(x, \cdot): \Theta \to \R$ is absolutely continuous on $\Theta$.
		\item For any $x \in X$, $f(x, \cdot): \Theta \to \R$ is differentiable on $\Theta$.
	\end{itemize}
	Then, the following holds:
	\begin{itemize}
		\item $V$ is absolutely continuous.
		\item For any selection $x^*$ from $X^*$, $V(\theta) = V(\underline{\theta}) + \int_{\underline{\theta}}^\theta f_\theta(x^*(s), s) ds$.
	\end{itemize}
\end{thm}
\begin{proof}
	Note that the absolute continuity of $f(x, \theta)$ implies that $f_\theta(x, \theta) \in L^1(\Theta)$ for any $x \in X$.
	\paragraph{(i) $V$ is absolutely continuous.}
	It is sufficient to show that $V$ is Lipschitz continuous. Fix any $\theta', \theta$. Since any integrable function is bounded, for any $x$ there exists $L>0$ s.t. $|f_\theta(x, \theta)| \leq L$ for almost all $\theta \in \Theta$.
	\begin{align*}
		|V(\theta') - V(\theta)|
		&=
		\left|
		\max_{x'} f(x', \theta') - \max_x f(x, \theta)
		\right| \\
		&\leq
		\max_x
		\left|
		f(x, \theta') - f(x, \theta)
		\right| 
		=
		\max_x
		\left|
		\int_{\theta'}^\theta f_\theta(x, s) ds
		\right| \\
		&\leq L \cdot |\theta' - \theta|
	\end{align*}
	
	\paragraph{(ii)}
	Fix any selection $x^*$ from $X^*$. By the result of (i),
	\[
	V(\theta) = V(\underline{\theta}) + \int_{\underline{\theta}}^\theta V'(s) ds
	\]
	Fix any selection $x^*$ and $\theta', \theta$ such that $\theta' > \theta$. By the definition of $V$ and $x^*$,
	\begin{align*}
		V(\theta) &= f(x^*(\theta), \theta) \geq f(x^*(\theta'), \theta) \\
		V(\theta') &= f(x^*(\theta'), \theta') \geq f(x^*(\theta), \theta')
	\end{align*}
	Hence,
	\[
	V(\theta') - V(\theta) \leq f(x^*(\theta'), \theta') - f(x^*(\theta'), \theta).
	\]
	\[
	\frac{V(\theta') - V(\theta)}{\theta' - \theta} \leq \frac{f(x^*(\theta'), \theta') - f(x^*(\theta'), \theta)}{\theta' - \theta}.
	\]
	Similarly,
	\[
	V(\theta) - V(\theta') \leq f(x^*(\theta'), \theta) - f(x^*(\theta'), \theta').
	\]
	\[
	\frac{V(\theta') - V(\theta)}{\theta - \theta'} \geq \frac{f(x^*(\theta'), \theta) - f(x^*(\theta'), \theta')}{\theta - \theta'}.
	\]
	Note that by assumption $f(x, \cdot)$ is differentiable at all $\theta \in \Theta$. Therefore, if $V$ is differentiable at $\theta$, we have $V'(\theta) = f_\theta(x^*(\theta), \theta)$.
\end{proof}


%%%
\subsubsection{RET}
\begin{itemize}
	\item Focus on the agent's utility: $u := u^A$.
	\item $A := \phi(\Theta)$. $V(\theta) := \max_{a \in A} u(a, \theta)$. $A^*(\theta) := \argmax_{a \in A} u(a, \theta)$.
	\item Assume that $u(a, \cdot)$ is absolutely continuous and differentiable on $\Theta$ for all $a \in A$.
	\item By incentive compatibility, $\phi(\theta) \in A^*(\theta)$ for all $\theta \in \Theta$: $\phi$ is a selection from $A^*$.
\end{itemize}

\begin{thm}[Revenue Equivalence Theorem]
	\[
	V(\theta) = V(\underline{\theta}) + \int_{\underline{\theta}}^\theta
	 u_\theta(\phi(s), s) ds
	\]
	In particular, under quasi-linear utility, 
	\[
	V(\theta) = V(\underline{\theta}) + \int_{\underline{\theta}}^\theta
	 v_\theta(x(s), s) ds
	\]
	\[
	t(\theta) = v(x(\theta), \theta) - V(\underline{\theta}) - \int_{\underline{\theta}}^\theta
	 v_\theta(x(s), s) ds
	\]
\end{thm}
\begin{proof}
	Milgrom and Segal. As for quasi-linear cases, the results follow from
	$$
	V(\theta) = v(x(\theta), \theta) - t(\theta)
	$$
\end{proof}

\begin{itemize}
	\item RET states that under any IC mechanism, except for the constant $V(\underline{\theta})$, the transfer from the agent to the principal is uniquely determined once the allocation rule $x$ is fixed.
\end{itemize}


%%%
\subsection{Characterization of IC}
\subsubsection{Monotone Comparative Statics}
This subsection is based on the lecture slides by John K.-H. Quah:

\url{http://www.johnquah.com/lecture-slides.html}

\begin{itemize}
	\item Consider parameterized optimization problems.
	\item We often want to know how optimizers and optimal values change according to the changes in parameters.
	\item comparative statics = Sensitivity analysis
	\item Implicit function theorem: Not only the direction of changes but also the rate of change. Many assumptions are required.
	\item Monotone comparative statics: Only the direction of changes. Fewer assumptions.
	\item $\Theta \subseteq \R$. Two functions $g: \Theta \to \R$ and $f: \Theta \to \R$.
\end{itemize}

\begin{df}[Single Crossing]
	$g$ dominates $f$ by single crossing property (SCP), $g \succsim_{SC} f$, if for all $x'' > x'$,
	\begin{itemize}
		\item $f(x'') - f(x') \geq 0 \implies g(x'') - g(x') \geq 0$
		\item $f(x'') - f(x') > 0 \implies g(x'') - g(x') > 0$
	\end{itemize}
	
	$\{f(\cdot, \theta)\}_{\theta \in \Theta}$ is an SCP family if
	$$
	\forall \theta'' > \theta' ; \ f(\cdot, \theta'') \succsim_{SC} f(\cdot, \theta')
	$$
\end{df}

\begin{df}[Increasing Differences]
	$g$ dominates $f$ by increasing differences, $g \succsim_{IN} f$, if for all $x'' > x'$, $$g(x'') - g(x') \geq f(x'') - f(x').$$
	$\{f(\cdot, \theta)\}_{\theta \in \Theta}$ satisfies increasing differences if
	$$
	\forall \theta'' > \theta' ; \ f(\cdot, \theta'') \succsim_{IN} f(\cdot, \theta')
	$$
\end{df}
\begin{df}[Strictly Increasing Differences]
	$g$ dominates $f$ by strictly increasing differences, $g \succsim_{SID} f$, if for all $x'' > x'$, $$g(x'') - g(x') > f(x'') - f(x').$$
	$\{f(\cdot, \theta)\}_{\theta \in \Theta}$ satisfies strictly increasing differences (SID) if
	$$
	\forall \theta'' > \theta' ; \ f(\cdot, \theta'') \succsim_{SID} f(\cdot, \theta')
	$$
\end{df}

\begin{rem}
	$g \succsim_{IN} f$ implies $g \succsim_{SC} f$.
\end{rem}
\begin{rem}
	$\{f(\cdot, \theta)\}_{\theta \in \Theta}$ satisfies SID iff $\{f(x, \cdot)\}_{x \in X}$ satisfies SID.
\end{rem}

\begin{thm}[Milgrom and Shannon (1994)]
	$X \subseteq \R$. $f,g: X \to \R$.
	\[
	[\forall Y \subseteq X; \ \argmax_{x \in Y} g(x) \geq \argmax_{x \in Y} f(x)
	]
	\equi g \succsim_{SC} f
	\]
	Note that, for $Y,Z \subseteq \R$,
	\[
	Y \geq Z
	\defi  [y \in Y, \ z \in Z
	\implies y \vee x \in Y, \ y \wedge z \in Z.
	]
	\]
\end{thm}
\begin{proof}.
	\paragraph{$\Rightarrow)$}
	We show contrapositive. Suppose that $g \not\succsim_{SC} f$.
	There exist $x'', x'$ such that $x'' > x'$ and at least one of the following holds:
	\begin{equation}
		f(x'') \geq f(x'), g(x'') < g(x') \label{ms1}
	\end{equation}
	or
	\begin{equation}
		f(x'') > f(x'), g(x'') \leq g(x') \label{ms2}
	\end{equation}
	Let $Y := \{x', x''\}$, $G_Y := \argmax_{x \in Y} g(x)$ and $F_Y := \argmax_{x \in Y} f(x)$.
	In case of (\ref{ms1}), $x' \vee x'' \notin G_Y$. In case of (\ref{ms2}), $x' \wedge x'' \notin F_Y$.
	
	\paragraph{$\Leftarrow)$}
	Fix any $Y \subseteq X$ and $x'', x' \in Y$ such that $x' \in G_Y$ and $x'' \in F_Y$. We need to show that $x' \vee x'' \in G_Y$ and $x' \wedge x'' \in F_Y$.
	First, since $x'' \in F_Y$, we have $f(x'') \geq f(x')$. By assumption, $g(x'') \geq g(x')$. Since $x' \in G_Y$, we have $x'' \in G_Y$ and $x' \vee x'' \in G_Y$.
	
	Next, we show $f(x'') = f(x')$. Note that this implies that $x' \wedge x'' \in F_Y$. 
	Suppose toward contradiction that $f(x'') > f(x')$. Then, since $g \succsim_{SC} f$, we have $g(x'') > g(x')$. This contradicts $x' \in G_Y$.
\end{proof}


%%%
\subsubsection{Characterization of IC}
\begin{ass}
	Quasi-linear utility. $v(x, \theta)$ is absolutely continuous and differentiable on $\Theta$ for all $x$.
\end{ass}

\begin{lem}
	Let $V(\theta) := v(x(\theta), \theta) - t(\theta)$.
	If a mechanism $(x,t)$ is IC, then
	\begin{equation}
	V(\theta) = V(\underline{\theta}) + \int_{\underline{\theta}}^\theta
	 v_\theta(x(s), s) ds \tag{LIC}	
	\end{equation}
\end{lem}
\begin{proof}
	RET.
\end{proof}

\begin{lem}
	If a mechanism $(x,t)$ is IC and $\{v(\cdot, \theta)\}_{\theta \in \Theta}$ satisfies SID, then
	\begin{equation}
	\text{$x(\theta)$ is non-decreasing in $\theta$.} \tag{M}
	\end{equation}
\end{lem}
\begin{proof}
	Fix $\theta'', \theta'$ such that $\theta'' > \theta'$. Since $\{v(\cdot, \theta)\}_{\theta \in \Theta}$ satisfies SID, $v(\cdot, \theta'') \succsim_{SID} v(\cdot, \theta')$.
%	By Milgrom-Shannon and IC, 
%	\[
%	x(\theta'')
%	\in \argmax_{x \in x(\Theta)} v(x, \theta'') \geq \argmax_{x \in x(\Theta)} v(x, \theta')
%	\ni x(\theta')
%	\]
	Suppose toward contradiction that $x(\theta'') < x(\theta')$. Since $v(\cdot, \theta'') \succsim_{SID} v(\cdot, \theta')$,
	\[
	v(x(\theta'), \theta'') - v(x(\theta''), \theta'')
	> v(x(\theta'), \theta') - v(x(\theta''), \theta') \geq 0
	\]
	This violates IC. A contradiction.
\end{proof}

\begin{itemize}
	\item The lemmas above shows that, assuming $\{v(\cdot, \theta)\}_{\theta \in \Theta}$ satisfies SID, IC of $(x,t)$ implies (LIC) and (M).
	\item We can show that the converse also holds.
\end{itemize}

\begin{lem}
	Assume that $\{v(\cdot, \theta)\}_{\theta \in \Theta}$ satisfies (S)ID. If the conditions (LIC) and (M) hold, then $(x,t)$ is IC.
\end{lem}
\begin{proof}
	Fix any $\theta, \theta'$. We need to show that $v(x(\theta), \theta) - t(\theta) \geq v(x(\theta'), \theta) - t(\theta')$.
	Note that, by (LIC), we have 
	\[
	t(\theta) = v(x(\theta), \theta) - V(\underline{\theta}) - \int_{\underline{\theta}}^\theta
	 v_\theta(x(s), s) ds
	\]
	
	Then,
	\begin{align*}
		&[v(x(\theta), \theta) - t(\theta)] - [v(x(\theta'), \theta) - t(\theta')] \\
		&=
		[v(x(\theta), \theta) - t(\theta)] - [v(x(\theta'), \theta) + v(x(\theta'), \theta') - v(x(\theta'), \theta') - t(\theta')] \\
		&=
		\int_{\underline{\theta}}^\theta v_\theta(x(s), s) ds
		- \int_{\underline{\theta}}^{\theta'} v_\theta(x(s), s) ds
		- [v(x(\theta'), \theta) - v(x(\theta'), \theta')] \\
		&= \int_{\theta'}^\theta v_\theta(x(s), s) ds
		- \int_{\theta'}^\theta v_\theta(x(s), \theta') ds
		= 
		\int_{\theta'}^\theta \underbrace{
		[v_\theta(x(s), s) - v_\theta(x(\theta'), s)]
		}_{\geq 0 \ \because \ ID}
		ds \geq 0
	\end{align*}
\end{proof}

\begin{thm}[Characterization of IC] \label{ic_char}
	Assume that $\{v(\cdot, \theta)\}_\theta$ satisfies SID. Then, 
	\[
	\text{$(x, t)$ is IC} \equi \text{$x$ is non-decreasing, and $t$ is calculated by (LIC)}
	\]
\end{thm}


%%%
\subsection{General Case: Rochet's Theorem and Cyclical Monotonicity}
\begin{itemize}
	\item Consider quasi-linear utility cases.
	\item Characterize IC mechanisms.
\end{itemize}

\begin{df}[weak monotonicity]
	An allocation rule $x: \Theta \to A$ is weakly monotone if
	\[
	\forall \theta, \theta' ; \ [v(x(\theta), \theta') - v(x(\theta), \theta)]  + [v(x(\theta'), \theta) - v(x(\theta'), \theta')] \leq 0
	\]
\end{df}

\begin{prop}
	If $(x,t)$ is IC, then $x$ is weakly monotone.
\end{prop}

\begin{df}[cyclical monotonicity]
	\[
	S := \{(\theta^1, \cdots, \theta^{k+1}) \mid \forall i \in [k+1]; \theta^i \in \Theta, \ \theta^1 = \theta^{k+1}, \ k \in \Z^+ \}
	\]
	An allocation rule $x$ ie cyclically monotone if
	, for any $(\theta^1, \cdots, \theta^{k+1}) \in S$, 
	\begin{equation}
		\sum_{i=1}^k [v(x^{i}, \theta^{i+1}) - v(x^{i}, \theta^{i})] \leq 0
		\text{ , where $x^i := x(\theta^i)$}
		\tag{CM} \label{cm}
	\end{equation}
\end{df}

\begin{thm}[Rochet (1987)]
	\[
	\exists t; \ (x,t): \text{IC } \equi \text{x is cyclically monotone}.
	\]
\end{thm}

\begin{proof}.
\paragraph{$\Rightarrow)$} Easy.
\paragraph{$\Leftarrow)$}
	Fix $\theta_0 \in \Theta$.
	\[
	S(\theta) := \{(\theta^1, \cdots, \theta^{k+1}) \mid \forall i \in [k+1]; \theta^i \in \Theta, \ \theta^1 = \theta_0, \ \theta^{k+1} = \theta, \ k \in \Z^+ \}
	\]
	\[
	V(\theta) := \sup_{(\theta^1, \cdots, \theta^{k+1}) \in S(\theta)} \sum_{i=1}^k [v(x^{i}, \theta^{i+1}) - v(x^{i}, \theta^{i})]
	\]
	\paragraph{(i) [$V(\theta_0) = 0$.]} By CM, $V(\theta_0) \leq 0$. Considering the case where $k := 1$, we see that $(\theta_0, \theta_0) \in S(\theta_0)$ satisfies $[v(x^1, \theta^2) - v(x^1, \theta^1)] = 0$. Therefore, $V(\theta_0) = 0$.
	
	\paragraph{(ii) [$V(\theta) < \infty$ for all $\theta \in \Theta$.]} Fix any $(\theta^1, \cdots, \theta^{k+1}) \in S(\theta)$.
	\begin{align*}
		0 = V(\theta_0)
		&\geq \sum_{i=1}^k [v(x^{i}, \theta^{i+1}) - v(x^{i}, \theta^{i})] + [v(x^{i+1}, \theta_0) - v(x^{i+1}, \theta^{k+1})] \\
		&= \sum_{i=1}^k [v(x^{i}, \theta^{i+1}) - v(x^{i}, \theta^{i})] + [v(x(\theta), \theta_0) - v(x(\theta), \theta)]
	\end{align*}
	\[
	\therefore 
		\sum_{i=1}^k [v(x^{i}, \theta^{i+1}) - v(x^{i}, \theta^{i})]
		\leq v(x(\theta), \theta) - v(x(\theta), \theta_0)
	\]
	\[
	\therefore 
		V(\theta)
		\leq v(x(\theta), \theta) - v(x(\theta), \theta_0)
	\]
	
	\paragraph{(iii) [Construct the transfer rule]}
	Fix any $\theta, \theta'$. By the same argument as in (ii), we can show that 
	\[
	V(\theta) \geq V(\theta') + v(x(\theta'), \theta) - v(x(\theta'), \theta')
	\]
	Define $t(\theta) := v(x(\theta), \theta) - V(\theta)$. With this $t$, a mechanism $(x,t)$ satisfies IC:
	\[
	v(x(\theta), \theta) - t(\theta) - (v(x(\theta'), \theta) - t(\theta'))
	= V(\theta) - V(\theta') - v(x(\theta'), \theta) + v(x(\theta'), \theta') \geq 0
	\]
\end{proof}



%%%
\subsection{Optimizing over Incentive Compatible Mechanisms}
\begin{ass}[Assumptions for IC characterization]
	In \S1.4, we assume that (1) utility function is quasi linear, (2) $v(x, \theta)$ is absolutely continuous and differentiable on $\Theta$ for all $x$, and (3) $\{v(\cdot, \theta)\}_\theta$ has SID.
\end{ass}
\begin{ass}[Private Values]
	$v^P(x, \theta) \equiv v^P(x)$
\end{ass}
\begin{ass}[Absolutely continuous distribution]
	The distribution function $F$ is absolutely continuous, i.e., 
	there exists $f:\Theta \to \R_+$ s.t. $F(x) := \int_{\underline{\theta}}^x f(s) ds$
\end{ass}

\begin{itemize}
	\item Optimal Mechanism = Revenue Maximizing Mechanism
	\item By Thm. \ref{ic_char}, $(x, t)$ is IC iff $x$ is nondecreasing and $t$ is calculated by Envelope theorem.
\end{itemize}
\begin{align*}
	\text{[Expected Revenue]}
	&=
	\E_\theta \left[
	t(\theta) + v^P(x(\theta))
	\right] \\
	&=
	\E_\theta \left[
	v(x(\theta), \theta) - V(\underline{\theta}) - \int_{\underline{\theta}}^\theta
	 v_\theta(x(s), s) ds + v^P(x(\theta))
	\right] \\
	&= \E_\theta \left[
	S(x(\theta), \theta) - V(\underline{\theta}) - \int_{\underline{\theta}}^\theta
	 v_\theta(x(s), s) ds
	\right]
\end{align*}
\begin{align*}
	\E_\theta \left[
	\int_{\underline{\theta}}^\theta
	 v_\theta(x(s), s) ds
	\right]
	&=
	\int_{\underline{\theta}}^{\bar{\theta}}
	\int_{\underline{\theta}}^\theta
	 v_\theta(x(s), s) ds
	d F(\theta) \\
	&= 
	\int_{\underline{\theta}}^{\bar{\theta}}
	\int_{s}^{\bar{\theta}}
	 v_\theta(x(s), s) 
	dF(\theta) ds \\
	&= 
	\int_{\underline{\theta}}^{\bar{\theta}}
	 (1 - F(s)) v_\theta(x(s), s)
	 ds \\
	&= 
	\int_{\underline{\theta}}^{\bar{\theta}}
	 (1 - F(\theta)) v_\theta(x(\theta), \theta)
	 d\theta \\
	&= 
	\int_{\underline{\theta}}^{\bar{\theta}}
	 v_\theta(x(\theta), \theta) \frac{1 - F(\theta)}{f(\theta)}
	 dF(\theta) \\
	&=
	\E_\theta \left[
	 v_\theta(x(\theta), \theta) \frac{1 - F(\theta)}{f(\theta)}
	\right]
\end{align*}
\[
\therefore \quad
\text{[Expected Revenue]}
=
\E_\theta \left[
	S(x(\theta), \theta) - V(\underline{\theta})
	- v_\theta(x(\theta), \theta) \frac{1 - F(\theta)}{f(\theta)}
	\right]
\]
\begin{itemize}
	\item The principal solves the following revenue maximization problem:
\end{itemize}
\[
\max_{x(\cdot), V(\underline{\theta})}
\E_\theta \left[
	S(x(\theta), \theta) - V(\underline{\theta})
	- v_\theta(x(\theta), \theta) \frac{1 - F(\theta)}{f(\theta)}
	\right]
\text{ s.t. }
x(\cdot): \text{increasing.}
\]

\begin{itemize}
	\item It is optimal to set $V(\underline{\theta}) := 0$, assuming that the outside option value is zero. Then, the problem can be reduced to
\end{itemize}
\[
\max_{x(\cdot)}
\E_\theta \left[
	\underbrace{S(x(\theta), \theta)
	- v_\theta(x(\theta), \theta) \frac{1 - F(\theta)}{f(\theta)}
	}_{(\star)}
	\right]
\text{ s.t. }
x(\cdot): \text{nondecreasing.}
\]
\begin{itemize}
	\item If $v^P(\theta) \equiv 0$,
	$(\star) = v(x(\theta), \theta)
	- v_\theta(x(\theta), \theta) \frac{1 - F(\theta)}{f(\theta)}
	=:$ [the virtual valuation of the bidder.]
\end{itemize}

\subsection*{Finding a Solution}
\begin{itemize}
	\item Just ignoring the monotonicity of $x$ and solve the relaxed problem. Fix $\theta \in \Theta$, and solve maximization problem for each $\theta$.
	\item \ocomment{[Is the argument below valid in case $x$ is not $\mC^1$ on $\Theta$?]}
\end{itemize}
\begin{ass}
	Assume that $v$ is linear in $\theta$.
\end{ass}
\begin{ass}
	Assume the interior solution. (?)
\end{ass}
\[
\max_x S(x, \theta) - v_\theta(x, \theta) \frac{1 - F(\theta)}{f(\theta)}
\]
\begin{equation}
	S_{x}(x, \theta) - v_{\theta x}(x, \theta) \frac{1 - F(\theta)}{f(\theta)} = 0  \tag{FOC}
\end{equation}
\begin{align*}
	&\underbrace{
	\left(
	\underbrace{
	S_{x\theta}(x, \theta)
	}_{= v_{x\theta}(x, \theta) \ (\because \ PV)}
	- v_{\theta x}(x, \theta) \frac{d}{d\theta}\frac{1 - F(\theta)}{f(\theta)}
	- \underbrace{
	v_{\theta x \theta}(x, \theta)}_{=0}
	\frac{1 - F(\theta)}{f(\theta)}
	\right)
	}_{= v_{x\theta}(x, \theta) \left(1 - \frac{d}{d\theta}\frac{1 - F(\theta)}{f(\theta)} \right)}
	d\theta \\
	&+
	\left(
	\underbrace{
	S_{xx}(x, \theta)
	- v_{\theta xx}(x, \theta) \frac{1 - F(\theta)}{f(\theta)}
	}_{\leq 0 \quad (\because \ SOC)}
	\right) dx
	= 0 \\
	&\equi
	\left( v_{x\theta}(x, \theta)  - v_{x\theta}(x, \theta) \frac{d}{d\theta}\frac{1 - F(\theta)}{f(\theta)} \right) d\theta + (\cdots)dx = 0 \\
	&\therefore \quad \sgn \left( \frac{dx}{d\theta} \right) = \sgn\left( v_{x\theta}(x, \theta)  - v_{x\theta}(x, \theta) \frac{d}{d\theta}\frac{1 - F(\theta)}{f(\theta)} \right) 
\end{align*}

\begin{itemize}
	\item Note that since $v$ has SID, $v_{x \theta} \geq 0$.
	\item The following condition (MHR: monotone hazard rate condition) is sufficient in order for $x$ to be nondecreasing:
\end{itemize}
\[
\frac{d}{d\theta}\frac{1 - F(\theta)}{f(\theta)} \leq 0
\equi \frac{d}{d\theta}\frac{f(\theta)}{1 - F(\theta)} \geq 0
\]


%%%
\newpage
\section{Many Agents}

\subsection{Setup}
\begin{df}[Solution Concepts] $(M, \phi)$: mechanism
	\begin{enumerate}
		\item $\sigma = (\sigma_1, \dots, \sigma_N)$ is a dominant strategy equilibrium (DSE) if
		\[
		\forall i \ \forall \theta_i \ \forall m_i \ \forall m_{-i} \forall \theta_{-i}; \quad
		u_i(\phi(\sigma_i(\theta_i), m_{-i} ; \theta_i, \theta_{-i}))
		\geq u_i(\phi(m_i, m_{-i} ; \theta_i, \theta_{-i}))
		\]
		\item $\sigma$ is ex-post equilibrium if
		\[
		\forall i \ \forall \theta_i \ \forall m_i \forall \theta_{-i}; \quad
		u_i(\phi(\sigma_i(\theta_i), \sigma_{-i}(\theta_{-i}) ; \theta_i, \theta_{-i}))
		\geq u_i(\phi(m_i, \sigma_{-i}(\theta_{-i}) ; \theta_i, \theta_{-i}))
		\]
		\textnormal{In words, as long as the other players are truthful, their type is not important for a players' incentives for truthful reporting.}
		\item $\sigma$ is Bayes-Nash equilibrium (BNE) in pure strategies if
		\[
		\forall i \ \forall \theta_i \ \forall m_i; \quad
		\E_{\theta_{-i} \mid \theta_i}[
		u_i(\phi(\sigma_i(\theta_i), \sigma_{-i}(\theta_{-i}) ; \theta_i, \theta_{-i}))]
		\geq
		\E_{\theta_{-i} \mid \theta_i}[u_i(\phi(m_i, \sigma_{-i}(\theta_{-i}) ; \theta_i, \theta_{-i}))]
		\]
	\end{enumerate}
\end{df}
\begin{rem}
	A DNE is ex-post eqm. An ex-post eqm is BNE. 
\end{rem}
\begin{rem}
	The revelation principle holds for all three equilibrium concepts.
\end{rem}

\subsection{Notions of Incentive Compatibility}
\begin{itemize}
	\item DSIC mechanisms, ex-post IC mechanisms, BNIC mechanisms.
\end{itemize}

\subsection{Individual Rationality}
\begin{ass}
	The value of an outside option is constant on type and normalized to zero.
\end{ass}
\begin{df} Consider an IC mechanism $(x,t)$.
	\begin{enumerate}
		\item $(x,t)$ is ex-post individually rational (IR) if
		\[
		\forall i \forall \theta; \quad
		v_i(x(\theta), \theta) - t_i(\theta) \geq 0
		\]
		\item $(x,t)$ is interim IR if
		\[
		\forall i \forall \theta; \quad
		\E_{\theta_{-i} \mid \theta_i}[v_i(x(\theta), \theta) - t_i(\theta)] \geq 0
		\]
		\item $(x,t)$ is ex-ante IR if
		\[
		\forall i \forall \theta; \quad
		\E_{\theta}[v_i(x(\theta), \theta) - t_i(\theta)] \geq 0
		\]
	\end{enumerate}
\end{df}
\begin{rem}
	An ex-post IR mechanism is interim IR and ex-ante IR.
\end{rem}
\begin{rem}
	For ex-post IR, it is sometimes useful to impose the following restriction: consider the case where other players are not truthful:
	\[
	\forall i \forall m_{-i} \forall \theta; \quad
	v_i(x(\theta_i, m_{-i}), \theta) - t_i(\theta_i, m_{-i}) \geq 0
	\]
\end{rem}

\subsection{Bayesian and Dominant Strategy Mechanisms}
??

\subsection{Efficient Mechanisms}
\begin{ass}
	Quasi-linear utilities, private values.
\end{ass}
\begin{df}[Private Values]
	The model has private values if
	\[
	\forall i \in \{0,1,\dots,N\} \ \forall \theta_{-i} \theta'_{-i} \in \Theta_{-i}; \quad
	v_i(x, \theta_i, \theta_{-i}) = v_i(x, \theta_i, \theta'_{-i}) \equiv v_i(x, \theta_i)
	\]
\end{df}

\begin{itemize}
	\item Consider the case where $v_0 \equiv 0$, $t_0 = \sum_{i=1}^N t_i$.
	\[
	x^*(\theta) \in \argmax_{x \in X}\sum_{i=1}^N v_i(x, \theta)
	= \argmax_{x \in X}\sum_{i=1}^N v_i(x, \theta_i)
	\]
\end{itemize}
\begin{df}[VCG mechanism]
	Fix any function $\tau_i: M_{-i} \to \R$ for all $i$. Define the transfer rule:
	\[
	t^*_i(m) := - \sum_{j \neq i} v_j(x^*(m), m_j) + \tau_i(m_{-i})
	\]
	The mechanism $(x^*, t^*)$ is called VCG mechanism.
\end{df}
\begin{rem}
	VDG mechanism is a DSIC mechanism.
\end{rem}
\begin{rem}[Green \& Laffont(1979)]
	If there are no restrictions on the domain of preferences for the players, then VDG mechanisms are the only mechanisms that make truthful revelation a dominant strategy for the efficient allocation rule $x^*$.
\end{rem}

\begin{df}[Pivot mechanism (the externality mechanism)]
	Pivot mechanism is a VCG mechanism that set 
	\[
	\tau_i(m_i) := \max_{x \in X} \sum_{j \neq i} v_j(x^*(m), m_j)
	\]
\end{df}
\begin{itemize}
	\item $W_{\mS}(\theta) := \max_{x \in X} \sum_{i \in \mS}v_i(x, \theta_i)$
	\item In a pivot mechanism, player $i$ pays her externality and gets her marginal contribution to the social welfare:
	\[
	t_i(\theta) = W_{[N] \setminus \{i\}}(\theta) - \sum_{j \neq i} v_j(x^*(\theta), \theta_j)
	\]
	\[
	v_i(x^*(\theta), \theta_i) - t_i(\theta) = W_{[N]}(\theta) - W_{[N] \setminus \{i\}}(\theta)
	\]
	\item Correlation in the agents' types makes no difference in the above argument: It works for all private values settings with quasi-linear payoffs.
\end{itemize}

\subsubsection{Budget Balance}
\begin{df}[Budget Balance] $(x,t): mechanism$.
	\begin{enumerate}
		\item $(x,t): mechanism$ is ex-post budget balanced if $\forall \theta; \ \sum_{i=1}^N t_i(\theta) = 0$.
		\item $(x,t): mechanism$ is ex-ante budget balanced if $\E_\theta [ \sum_{i=1}^N t_i(\theta)] = 0$.
	\end{enumerate}
\end{df}
\begin{ass}
	independent type, i.e., $\forall i; \ \theta_i \indep \theta_{-i}$.
\end{ass}
\begin{df}[AGV mechanism (expected externality mechanism)] A mechanism $(x^*, t)$, with the following transfer rule $t$, is called AGV mechanism:
	\[
	t_i(m) := - \underbrace{
	\E_{\theta_{-i}} \left[
	\sum_{j \neq i} v_j(x^*(m_i, \theta_{-i}), \theta_j)
	\right]
	}_{=: \mE_i(m_i)}
	+ \tau_i(m_{-i})
	\]
\end{df}
\begin{rem}
	In AGV mechanism, truthful report is a BNIC. (NB: No need to use independence here.)
\end{rem}
\begin{rem} AGV mechanism with the following $(\tau_i)_i$ is ex-post BB.
\[
\tau_i(m_{-i}) = \frac{\sum_{j \neq i} \mE_j(m_j)}{N-1}
\]
\end{rem}



\subsubsection{BB in BNE}
\begin{itemize}
	\item What more can be done with BNE as the solution concept?
	\item As long as we assume IPV, all BNE implementing the efficient decision rule have the same expected payoffs.
	\item The expected payment etc. can be calculated using VCG.
\end{itemize}


\end{document}